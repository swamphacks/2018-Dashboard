<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		 <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
		<title>SwampHacks Dashboard</title>
		<meta name="description" content="

		SwampHacks is a 36 hour open coding event where students become creators.
		In the time allotted, students from around the country come together at the
		University of Florida to collaborate on projects, mingle in activities, and
		network with sponsors for a fully immersive experience.

		"/>
		<!-- Stylesheets
    ================================================== -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />
		<link href="https://fortawesome.github.io/Font-Awesome/assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<!-- Favicon
    ================================================== -->
   	<link rel="icon" type="image/png" href="favicon.png" />
		<!-- Icons & Fonts
		================================================== -->
		<link rel="stylesheet" href="css/font-awesome.css">
		<link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700|Playfair+Display:400,400i,700i" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<!-- MLH Badge
		================================================== -->
		<!-- <a id="mlh-trust-badge" style="display:block;max-width:100px;min-width:60px;position:absolute;right:50px;top:0;width:10%;z-index:0" href="https://mlh.io/seasons/na-2018/events?utm_source=na-2018&utm_medium=TrustBadge&utm_campaign=na-2018&utm_content=white" target="_blank"><img src="https://s3.amazonaws.com/logged-assets/trust-badge/2018/white.svg" alt="Major League Hacking 2017 Hackathon Season" style="width:100%"></a> -->
	</head>

  <body>

	<div id="confirmedPopup" class="hide">
		<div class="pair">
		<svg id="successAnimation" class="animated" xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 70 70">
		<path id="successAnimationResult" fill="white" d="M35,60 C21.1928813,60 10,48.8071187 10,35 C10,21.1928813 21.1928813,10 35,10 C48.8071187,10 60,21.1928813 60,35 C60,48.8071187 48.8071187,60 35,60 Z M23.6332378,33.2260427 L22.3667622,34.7739573 L34.1433655,44.40936 L47.776114,27.6305926 L46.223886,26.3694074 L33.8566345,41.59064 L23.6332378,33.2260427 Z"/>
		<circle id="successAnimationCircle" cx="35" cy="35" r="24" stroke="white" stroke-width="2" stroke-linecap="round" fill="transparent"/>
		<polyline id="successAnimationCheck" stroke="white" stroke-width="2" points="23 34 34 43 47 27" fill="transparent"/>
		</svg>
		<span class="popuptxt">Confirmed!</span>
	</div>
	</div>

  <div id="layout" class="">
      <!-- Menu toggle -->
      <a href="#menu" id="menuLink" class="menu-link">
          <!-- Icon -->
          <!-- <span><img id="logosmall" class="" src="img/logoblue.svg"></img></span> -->
          <span>SH</span>
      </a>

      <div id="menu" class="">

          <div class="pure-menu">

              <a class="pure-menu-heading" href="#">
                <img id="logo" class="" src="img/logoblue.svg"></img>
              </a>

              <div class="menu-items-con">

                <ul class="pure-menu-list">

                    <li id="op1" class="pure-menu-item top-ln pure-menu-selected">
                      <a href="#" class="pure-menu-link" onclick="menuClick(1)">Dashboard</a>
                    </li>

                    <li id="op2" class="pure-menu-item top-ln">
                      <a href="#" class="pure-menu-link" onclick="menuClick(2)">Profile <i class="fa fa-exclamation-triangle" aria-hidden="true"></i></a>
                    </li>

                    <li id="op3" class="pure-menu-item top-ln">
                        <a href="#" class="pure-menu-link" onclick="menuClick(3)">Logout</a>
                    </li>

                    <li id="op4" class="pure-menu-item bottom-ln">
                      <a href="#" class="pure-menu-link locked-link" onclick="menuClick(4)">Live! <i class="fa fa-lock" aria-hidden="true"></i></a>
                    </li>
                </ul>

              </div>
          </div>
      </div>

      <div id="dashboard" class="show">

        <h1 class="header-main-type">Dashboard</h1>

				<div class="container-fluid notif-con">
					<div class="row">

						<div class="col-md-12">
							<h3 class="header-sub-type" id="welcomeMessage">Welcome, Albert!</h3>
							<p class="descrip-txt">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque tempor purus lacus, et molestie erat accumsan vitae. Quisque ornare, eros ac finibus imperdiet, mi tortor tristique est, vitae laoreet erat nisl facilisis mi. Fusce condimentum mi dui, ut viverra velit gravida id.</p>
						</div>

						<div class="col-md-12 notif top-margin">
							<p class="notif-txt">Your Status: <span class="status green" id="dashStatus">ACCEPTED</span></p>
						</div>

						<div class="col-md-12 top-margin descrip-txt">
							Let us know if you're coming by confirming your spot! Please remember to update
							your status if you decide you cannot attend.
						</div>

						<div class="row">
							<div class="col-md-6 top-margin">
								<button class="button green" onclick="confirmSpotBtnClicked()">
									<p id="confirmSpot">Confirm my spot!</p>
								</button>
							</div>

							<div class="col-md-6 top-margin">
								<button class="button dark" id="rejectSpot" onclick="rejectSpotBtnClicked()">
									<p>I can't go <i class="fa fa-frown-o" aria-hidden="true"></i></p>
								</button>
							</div>
						</div>


					</div>
				</div>

      </div>

      <div id="info" class="hide">

        <h1 class="header-main-type">Profile</h1>

				<div class="container-fluid notif-con">
					<div class="row">

						<div class="col-md-12">
							<!-- <h3 class="header-sub-type">Welcome, Albert!</h3> -->
							<p class="descrip-txt">
								Congratulations on being accepted! Please let us know
								a few more things so we can make your experience better during
								the hackathon.
							</p>
						</div>

						<div class="row">
							<form id="profileForm" class="" autocomplete="off">
								<div class="col-md-6 top-margin">
									<label class="form-lbl" for="q1" name="">T-Shirt Size *</label>
									<input class="form-field" id="shirtSize" name="q1" type="text" placeholder="Medium" required/>
								</div>

								<div class="col-md-6 top-margin">
									<label class="form-lbl" for="q1" name="">Dietary Restrictions *</label>
									<input class="form-field" id="diet" name="q1" type="text" placeholder="Halal" required/>
								</div>

								<div class="col-md-12 top-margin">
									<label class="form-lbl" for="q1" name="">Anything else we should know?</label>
									<input class="form-field" id="extraInfo" name="q1" type="text" placeholder=""/>
								</div>
							</form>

						</div>

						<div class="col-md-12 top-margin descrip-txt">
							Let us know if you're coming by confirming your spot! Please remember to update
							your status if you decide you cannot attend. This is just filler text.
						</div>

						<div class="col-md-12 top-margin descrip-txt hide" id="profileStatusTxt">
							Please fill in all fields!
						</div>

						<div class="row">
							<div class="col-md-12 top-margin">
								<button class="button green" onclick="updateInfoBtnClicked()">
									<p>Update Info</p>
								</button>
							</div>
						</div>


					</div>
				</div>

      </div>

      <div id="login" class="hide">

        <h1 class="header-main-type">Login</h1>

      </div>

  </div>




  <script src="js/menu.js"></script>
  <script src="js/jquery.js"></script>
  <script src="js/classie.js"></script>

  </body>

	<script src="https://www.gstatic.com/firebasejs/3.7.6/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.7.6/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.7.6/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.7.6/firebase.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
	<script>

		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyCkPM5Ta8WgzxpOP6O9WuLWD6Irkd6GAPc",
			authDomain: "swamphacks-applicants.firebaseapp.com",
			databaseURL: "https://swamphacks-applicants.firebaseio.com",
			projectId: "swamphacks-applicants",
			storageBucket: "swamphacks-applicants.appspot.com",
			messagingSenderId: "622854578748"
		};
		firebase.initializeApp(config);

	</script>

  <script>

		var ref = firebase.database().ref();
		var usersRef = ref.child("applicants");
		var userObj = JSON.parse(localStorage.getItem('loggedInUser'));
		var loggedInUserKey = localStorage.getItem('loggedInUserKey');

		if (userObj === null) {
			window.location.href = "login.html";
		}

		console.log(userObj);
		console.log(loggedInUserKey);

		$("#welcomeMessage").text("Welcome, " + userObj.fname + "!");

		if (userObj.dietaryRestriction !== undefined || userObj.tshirtSize !== undefined) {
			$(".fa-exclamation-triangle").addClass("hide");
			$(".fa-exclamation-triangle").removeClass("showIn");
		} else {
			$(".fa-exclamation-triangle").addClass("showIn");
			$(".fa-exclamation-triangle").removeClass("hide");
		}

		if (userObj.dietaryRestriction !== undefined) {

			$("#diet").val(userObj.dietaryRestriction);

		}

		if (userObj.tshirtSize !== undefined) {

			$("#shirtSize").val(userObj.tshirtSize);

		}

		if (userObj.extraInfo !== undefined) {

			$("#extraInfo").val(userObj.extraInfo);

		}

		if (userObj.status !== undefined) {

			$("#dashStatus").text(userObj.status);

			if (userObj.status === "CONFIRMED") {
				$("#dashStatus").addClass("green");
				$("#dashStatus").removeClass("dark");
				$("#confirmSpot").text("See you there!");
			} else if (userObj.status === "NOT ATTENDING")  {
				$("#dashStatus").removeClass("green");
				$("#dashStatus").addClass("dark");
				$("#confirmSpot").text("Confirm my spot!");
			}

		}

		function rejectSpotBtnClicked() {

			$("#dashStatus").text("NOT ATTENDING");
			$("#confirmSpot").text("Confirm my spot!");
			$("#dashStatus").addClass("dark");
			$("#dashStatus").removeClass("green");

			var loggedInUserRef = usersRef.child(loggedInUserKey);

			loggedInUserRef.update({
				status: "NOT ATTENDING"
			});

			usersRef.orderByChild("email").equalTo(userObj.email).on("value", function(snapshot) {

				 // Getting the info of the found user and storing it in local storage
				 snapshot.forEach(function(childSnapshot) {

					 var key = childSnapshot.key;
					 var childData = childSnapshot.val();
					 localStorage.setItem('loggedInUser', JSON.stringify(childData));
					 localStorage.setItem('loggedInUserKey', key);

					 userObj = JSON.parse(localStorage.getItem('loggedInUser'));
					 loggedInUserKey = localStorage.getItem('loggedInUserKey');

				 });

			});

		}

		function confirmSpotBtnClicked() {

			var delay = 3000;

			if (userObj.status !== "CONFIRMED") {

				// Show the popup
				$("#confirmedPopup").removeClass("hide");
				$("#confirmedPopup").addClass("showflex");

				setTimeout(function() {

					$("#confirmedPopup").removeClass("showflex");
					$("#confirmedPopup").addClass("hide");

				}, delay);

			}

			$("#dashStatus").text("CONFIRMED");
			$("#confirmSpot").text("See you there!");
			$("#dashStatus").addClass("green");
			$("#dashStatus").removeClass("dark");

			var loggedInUserRef = usersRef.child(loggedInUserKey);

			loggedInUserRef.update({
				status: "CONFIRMED"
			});

			usersRef.orderByChild("email").equalTo(userObj.email).on("value", function(snapshot) {

				 // Getting the info of the found user and storing it in local storage
				 snapshot.forEach(function(childSnapshot) {

					 var key = childSnapshot.key;
					 var childData = childSnapshot.val();
					 localStorage.setItem('loggedInUser', JSON.stringify(childData));
					 localStorage.setItem('loggedInUserKey', key);

					 userObj = JSON.parse(localStorage.getItem('loggedInUser'));
					 loggedInUserKey = localStorage.getItem('loggedInUserKey');

				 });

			});

		}

		function updateInfoBtnClicked() {

			var dietaryRestriction = $("#diet").val();
			var tshirtSize = $("#shirtSize").val();
			var extraInfo = $("#extraInfo").val();

			if (dietaryRestriction !== "" && tshirtSize !== "") {

				var loggedInUserRef = usersRef.child(loggedInUserKey);

				if (extraInfo !== "") {

					loggedInUserRef.update({
						dietaryRestriction: dietaryRestriction,
						tshirtSize: tshirtSize,
						extraInfo: extraInfo
					});

				} else {

					loggedInUserRef.update({
						dietaryRestriction: dietaryRestriction,
						tshirtSize: tshirtSize
					});

				}

				usersRef.orderByChild("email").equalTo(userObj.email).on("value", function(snapshot) {

					console.log("Checking user");

					 // Getting the info of the found user and storing it in local storage
					 snapshot.forEach(function(childSnapshot) {

						 var key = childSnapshot.key;
						 var childData = childSnapshot.val();
						 localStorage.setItem('loggedInUser', JSON.stringify(childData));
						 localStorage.setItem('loggedInUserKey', key);

						 userObj = JSON.parse(localStorage.getItem('loggedInUser'));
				 		 loggedInUserKey = localStorage.getItem('loggedInUserKey');

					 });

				});

				// SUCCESS
				$("#profileStatusTxt").text("Info Updated!");
				$("#profileStatusTxt").addClass("show");
				$("#profileStatusTxt").addClass("greenTxt");
				$("#profileStatusTxt").removeClass("redTxt");
				$(".fa-exclamation-triangle").addClass("hide");

			} else {

				// ERROR
				$("#profileStatusTxt").text("Please fill in your t-shirt size and dietary restriction!");
				$("#profileStatusTxt").addClass("show");
				$("#profileStatusTxt").addClass("redTxt");
				$("#profileStatusTxt").removeClass("greenTxt");

			}

		}

    function menuClick(item) {

			$("#layout").removeClass("active");
			$("#menu").removeClass("active");
			$("#menuLink").removeClass("active");


      // Hiding and showing the appropriate info
      if (item === 1) {

        $("#op1").addClass("pure-menu-selected");
        $("#op2").removeClass("pure-menu-selected");
        $("#op3").removeClass("pure-menu-selected");

        $("#dashboard").addClass("show");
        $("#dashboard").removeClass("hide");

        $("#info").addClass("hide");
        $("#info").removeClass("show");

        $("#login").addClass("hide");
        $("#login").removeClass("show");

				if (userObj.status !== undefined) {

					$("#dashStatus").text(userObj.status);

					if (userObj.status === "CONFIRMED") {
						$("#dashStatus").addClass("green");
						$("#dashStatus").removeClass("dark");
						$("#confirmSpot").text("See you there!");
					} else if (userObj.status === "NOT ATTENDING")  {
						$("#dashStatus").removeClass("green");
						$("#dashStatus").addClass("dark");
						$("#confirmSpot").text("Confirm my spot!");
					}

				}

      } else if (item === 2) {

        $("#op2").addClass("pure-menu-selected");
        $("#op3").removeClass("pure-menu-selected");
        $("#op1").removeClass("pure-menu-selected");

        $("#dashboard").addClass("hide");
        $("#dashboard").removeClass("show");

        $("#info").addClass("show");
        $("#info").removeClass("hide");

        $("#login").addClass("hide");
        $("#login").removeClass("show");

				if (userObj.dietaryRestriction !== undefined) {

					$("#diet").val(userObj.dietaryRestriction);

				}

				if (userObj.tshirtSize !== undefined) {

					$("#shirtSize").val(userObj.tshirtSize);

				}

				if (userObj.extraInfo !== undefined) {

					$("#extraInfo").val(userObj.extraInfo);

				}

				$("#profileStatusTxt").addClass("hide");
				$("#profileStatusTxt").removeClass("show");

      } else if (item === 3) {

        $("#op3").addClass("pure-menu-selected");
        $("#op2").removeClass("pure-menu-selected");
        $("#op1").removeClass("pure-menu-selected");

        $("#dashboard").addClass("hide");
        $("#dashboard").removeClass("show");

        $("#info").addClass("hide");
        $("#info").removeClass("show");

				firebase.auth().signOut().then(function() {
				  // Sign-out successful.
					console.log("Logout Succesful.");
					localStorage.setItem('loggedInUser', null);
					localStorage.setItem('loggedInUserKey', null);

					window.location.href = "login.html";

				}, function(error) {
				  // An error happened.
					console.log("Error Logging out.");
				});

      }
    }

  </script>

</html>
